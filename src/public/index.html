<head>
    <!-- webcomponents, polymer standard, polymer-ts -->
    <script src="bower_components/webcomponentsjs/webcomponents-lite.js"></script>
    <link rel="import" href="bower_components/polymer/polymer.html">
    <link rel="import" href="bower_components/paper-button/paper-button.html">
    <link rel="import" href="bower_components/iron-icon/iron-icon.html">
    <link rel="import" href="bower_components/vaadin-upload/vaadin-upload.html">
    <link href="https://fonts.googleapis.com/css?family=Roboto|Roboto+Slab:300,400" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Raleway" rel="stylesheet">
    <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>
    <link rel="stylesheet" href="css/main.css">
    <main-page></main-page>
</head>

<dom-module id="main-page">
    <template>
        <div id="header">
            <h1>Triangularizer</h1>
        </div>
        <div id="menu_item">
            <vaadin-upload target="/"
                           method="POST"
                           headers="{'Accept': 'application/pdf'}"
                           timeout=15000
                           max-files="1"
                           on-upload-start="uploadStarted">
                <div class="drop-label">
                    <iron-icon icon="description"></iron-icon>
                    Upload a video to triangularize!
                </div>
            </vaadin-upload>
        </div>
        <div id="loading_box">
            <div id="up_arrow" class="animated bounce"></div>
            <h3>We're working on it!</h3>
        </div>
        
        <div id="footer">
            <i class="fa fa-github fa-2x" aria-hidden="true"></i>
            <p>Triangularizer</p>
        </div>
        
    </template>


    <script>
        Polymer({
            is: 'main-page',
            ready: function() {
                var uploader = document.querySelector('vaadin-upload');
                uploader.addEventListener('upload-response', function (e) {
                    if (e.detail.xhr.status == 200) {
                        e.detail.file.error = JSON.parse(xhr.responseText).error;
                    }
                });
            },
            uploadStarted: function(event) {
                var dotIndex = event.detail.file.name.lastIndexOf('.');
                var fileExt = event.detail.file.name.substring(dotIndex + 1);
                var uploader = document.querySelector('vaadin-upload');

                if (fileExt === "pdf") {
                    uploader.interruptUpload();
                }
                
                
                var $error_message = $(".drop-label");
                $error_message.text("Please only upload .mp4 files!").css("color", "#dd2c00");
            }
        });


    </script>

</dom-module>